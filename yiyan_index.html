<!DOCTYPE html>
<html lang="zh" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>âœ¨ ä¸€è¨€ Â· åˆ†ç±»ç‰ˆ</title>
    <style>
        :root {
            --bg: #f8f9fa;
            --card-bg: white;
            --text: #333;
            --border: #4a90e2;
            --accent: #007bff;
            --success: #5cb85c;
            --danger: #d9534f;
            --warning: #f0ad4e;
            --shadow: rgba(0, 0, 0, 0.1);
            --radius: 16px;
            --transition: all 0.3s ease;
            --font: "Segoe UI", "Microsoft YaHei", sans-serif;
        }

        [data-theme="dark"] {
            --bg: #1a1a1a;
            --card-bg: #252525;
            --text: #e0e0e0;
            --border: #5caeff;
            --accent: #5caeff;
            --success: #5cb85c;
            --danger: #e74c3c;
            --warning: #e0a500;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            transition: var(--transition);
        }

        body {
            font-family: var(--font);
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg) 0%, #e4edf5 100%);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 32px;
            margin: 0 0 8px;
            font-weight: 500;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: var(--accent);
        }

        /* è¯­å½•å¡ç‰‡ */
        .quote-card {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 8px 30px var(--shadow);
            text-align: center;
            color: var(--text);
            line-height: 1.7;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 1px solid rgba(74, 144, 226, 0.2);
        }

        .quote-content {
            font-size: 20px;
            font-weight: 500;
        }

        .quote-source {
            font-size: 14px;
            color: #888;
            margin-top: 12px;
        }

        [data-theme="dark"] .quote-source {
            color: #aaa;
        }

        /* åˆ†ç±»æŒ‰é’®ç»„ */
        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 16px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: var(--font);
        }

        button[data-cat] {
            background-color: var(--accent);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        button:active {
            transform: translateY(0);
        }

        /* æ“ä½œæŒ‰é’® */
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        button#refresh {
            background-color: var(--accent);
            color: white;
        }

        button#copy {
            background-color: var(--success);
            color: white;
        }

        button#save {
            background-color: var(--warning);
            color: #333;
        }

        button#clear {
            background-color: var(--danger);
            color: white;
        }

        button#toggle-favorites {
            background-color: #6c757d;
            color: white;
        }

        /* æ”¶è—é¢æ¿ */
        .favorites-panel {
            background-color: var(--card-bg);
            border-radius: var(--radius);
            padding: 16px;
            box-shadow: 0 4px 15px var(--shadow);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            border: 1px solid rgba(74, 144, 226, 0.2);
        }

        .favorites-panel h3 {
            margin: 0 0 12px;
            font-size: 18px;
            color: var(--accent);
        }

        .favorite-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(74, 144, 226, 0.1);
            border-radius: 6px;
            font-size: 15px;
            border-left: 3px solid var(--accent);
        }

        .empty {
            color: #aaa;
            font-style: italic;
            text-align: center;
        }

        .tip {
            text-align: center;
            font-size: 14px;
            color: #888;
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1>âœ¨ ä¸€è¨€ Â· åˆ†ç±»ç‰ˆ</h1>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™ æš—é»‘æ¨¡å¼</button>
        </header>

        <!-- è¯­å½•å±•ç¤º -->
        <div class="quote-card">
            <p class="quote-content" id="quote">ç‚¹å‡»ä¸‹æ–¹åˆ†ç±»ï¼Œè·å–ä¸€å¥æ‰“åŠ¨äººå¿ƒçš„è¯â€¦â€¦</p>
            <p class="quote-source" id="source"></p>
        </div>

        <!-- åˆ†ç±»æŒ‰é’® -->
        <div class="buttons">
            <button data-cat="a">ğŸ® åŠ¨ç”»</button>
            <button data-cat="b">ğŸ–¼ï¸ æ¼«ç”»</button>
            <button data-cat="c">ğŸ•¹ï¸ æ¸¸æˆ</button>
            <button data-cat="d">ğŸ“– æ–‡å­¦</button>
            <button data-cat="e">âœï¸ åŸåˆ›</button>
            <button data-cat="f">ğŸŒ ç½‘ç»œ</button>
            <button data-cat="g">ğŸ”§ å…¶ä»–</button>
            <button data-cat="h">ğŸ¬ å½±è§†</button>
            <button data-cat="i">ğŸ“š è¯—è¯</button>
            <button data-cat="j">ğŸµ ç½‘æ˜“äº‘</button>
            <button data-cat="k">ğŸ§  å“²ç†</button>
            <button data-cat="l">ğŸ˜„ æŠ–æœºçµ</button>
            <button data-cat="all">ğŸ² éšæœº</button>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions">
            <button id="refresh">ğŸ”„ æ¢ä¸€å¥</button>
            <button id="copy">ğŸ“‹ å¤åˆ¶</button>
            <button id="save">â¤ï¸ æ”¶è—</button>
            <button id="clear">ğŸ—‘ï¸ æ¸…ç©º</button>
            <button id="toggle-favorites">â­ æˆ‘çš„æ”¶è—</button>
        </div>

        <!-- æ”¶è—é¢æ¿ -->
        <div class="favorites-panel" id="favoritesPanel">
            <h3>æˆ‘çš„æ”¶è— â¤ï¸</h3>
            <div id="favoritesList">
                <p class="empty">è¿˜æ²¡æœ‰æ”¶è—å“¦ï½</p>
            </div>
        </div>

        <p class="tip">
            åŸºäº <a href="https://developer.hitokoto.cn" target="_blank" style="color:inherit">ä¸€è¨€ Hitokoto API</a> é©±åŠ¨
        </p>
    </div>

    <script>
        const quoteEl = document.getElementById('quote');
        const sourceEl = document.getElementById('source');
        const favoritesList = document.getElementById('favoritesList');
        const favoritesPanel = document.getElementById('favoritesPanel');
        let currentCat = 'i'; // é»˜è®¤è¯—è¯
        let currentText = '';
        let favorites = JSON.parse(localStorage.getItem('quotes-favorites')) || [];
        const themeToggle = document.getElementById('themeToggle');

        // ç±»å‹åç§°æ˜ å°„
        const typeNames = {
            a: 'åŠ¨ç”»', b: 'æ¼«ç”»', c: 'æ¸¸æˆ', d: 'æ–‡å­¦', e: 'åŸåˆ›',
            f: 'ç½‘ç»œ', g: 'å…¶ä»–', h: 'å½±è§†', i: 'è¯—è¯', j: 'ç½‘æ˜“äº‘', k: 'å“²ç†', l: 'æŠ–æœºçµ'
        };

        // è·å–ä¸€æ¡è¯­å½•
        async function fetchQuote(cat) {
            quoteEl.textContent = 'åŠ è½½ä¸­...';
            sourceEl.textContent = '';
            try {
                let url;
                if (cat === 'all') {
                    const cats = 'abcdefghijkl';
                    const randomCat = cats[Math.floor(Math.random() * cats.length)];
                    url = `https://v1.hitokoto.cn?c=${randomCat}`;
                } else {
                    url = `https://v1.hitokoto.cn?c=${cat}`;
                }

                const res = await fetch(url);
                const data = await res.json();
                const typeName = typeNames[data.type] || 'æœªçŸ¥';
                const text = `${data.hitokoto} â€”â€” ${data.from || 'æœªçŸ¥æ¥æº'}`;

                quoteEl.innerHTML = `<strong>${data.hitokoto}</strong>`;
                sourceEl.textContent = `â€”â€” ${data.from || 'æœªçŸ¥æ¥æº'} [${typeName}]`;
                currentText = text;
                currentCat = cat;
            } catch (err) {
                quoteEl.textContent = 'è·å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                sourceEl.textContent = 'ç‚¹å‡»â€œæ¢ä¸€å¥â€é‡è¯•';
                console.error('API Error:', err);
            }
        }

        // æ”¶è—
        document.getElementById('save').addEventListener('click', function () {
            if (!currentText) return alert('è¿˜æ²¡æœ‰å†…å®¹å¯ä»¥æ”¶è—');
            if (favorites.includes(currentText)) {
                return alert('è¿™å¥å·²ç»æ”¶è—è¿‡äº†ï¼');
            }
            favorites.push(currentText);
            localStorage.setItem('quotes-favorites', JSON.stringify(favorites));
            renderFavorites();
            this.textContent = 'âœ… å·²æ”¶è—ï¼';
            setTimeout(() => { this.textContent = 'â¤ï¸ æ”¶è—'; }, 1500);
        });

        // æ¸²æŸ“æ”¶è—
        function renderFavorites() {
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p class="empty">è¿˜æ²¡æœ‰æ”¶è—å“¦ï½</p>';
                return;
            }
            favoritesList.innerHTML = '';
            favorites.forEach(item => {
                const div = document.createElement('div');
                div.className = 'favorite-item';
                div.innerText = item;
                favoritesList.appendChild(div);
            });
        }

        // åˆ‡æ¢æ”¶è—é¢æ¿
        document.getElementById('toggle-favorites').addEventListener('click', () => {
            const isHidden = favoritesPanel.style.display === 'none';
            favoritesPanel.style.display = isHidden ? 'block' : 'none';
            this.textContent = isHidden ? 'âŒ æ”¶èµ·æ”¶è—' : 'â­ æˆ‘çš„æ”¶è—';
        });

        // å¤åˆ¶
        document.getElementById('copy').addEventListener('click', function () {
            if (!currentText) return alert('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
            navigator.clipboard?.writeText(currentText)
                .then(() => {
                    this.textContent = 'âœ… å·²å¤åˆ¶ï¼';
                    setTimeout(() => { this.textContent = 'ğŸ“‹ å¤åˆ¶'; }, 1500);
                })
                .catch(() => {
                    prompt('å¤åˆ¶æˆåŠŸï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼š', currentText);
                });
        });

        // æ¸…ç©º
        document.getElementById('clear').addEventListener('click', () => {
            quoteEl.textContent = 'å·²æ¸…ç©º';
            sourceEl.textContent = '';
            currentText = '';
        });

        // æ¢ä¸€å¥ï¼ˆå½“å‰åˆ†ç±»ï¼‰
        document.getElementById('refresh').addEventListener('click', () => {
            fetchQuote(currentCat);
        });

        // ç»‘å®šåˆ†ç±»æŒ‰é’®
        document.querySelectorAll('button[data-cat]').forEach(btn => {
            btn.addEventListener('click', () => {
                const cat = btn.getAttribute('data-cat');
                fetchQuote(cat);
            });
        });

        // ä¸»é¢˜åˆ‡æ¢
        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
            themeToggle.textContent = isDark ? 'â˜€ï¸ ç™½å¤©æ¨¡å¼' : 'ğŸŒ™ æš—é»‘æ¨¡å¼';
        });

        // åˆå§‹åŒ–
        renderFavorites();
        fetchQuote('i'); // é»˜è®¤åŠ è½½è¯—è¯
    </script>
</body>

</html>